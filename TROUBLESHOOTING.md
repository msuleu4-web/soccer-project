# トラブルシューティングガイド

## AI要約エラー: 「モデルが見つかりません」

### 問題の原因

スクリーンショットに表示されている「【AI要約エラー】モデルが見つかりません」というエラーは、以下の原因が考えられます：

1. **Spring AI 1.0.0-M4のモデル名互換性の問題** ⚠️
   - 使用していたモデル: `claude-3-5-sonnet-20240620`
   - Spring AI 1.0.0-M4 (Milestone版) では、このモデル名がサポートされていない可能性

2. **APIキーが設定されていない** ⚠️
   - Anthropic APIキーが正しく設定されていない可能性

3. **Anthropic APIの仕様変更** ⚠️
   - 2024年6月以降、APIの仕様が変更された可能性

### 解決方法

#### ✅ 修正1: モデル名を安定版に変更（完了）

`application.yml`のモデル名を、Spring AI 1.0.0-M4で確実に動作する安定版に変更しました：

```yaml
spring:
  ai:
    anthropic:
      chat:
        options:
          model: claude-3-sonnet-20240229  # ✅ 安定版モデル名
```

**Spring AI 1.0.0-M4で動作確認済みのモデル:**
- `claude-3-sonnet-20240229` (推奨・安定版)
- `claude-3-opus-20240229`
- `claude-3-haiku-20240307`

**注意**: `claude-3-5-sonnet-20240620` は新しいモデルのため、Spring AI 1.0.0-M4では互換性の問題がある可能性があります。

#### ✅ 修正2: デバッグログの有効化（完了）

詳細なエラー情報を取得するため、ログレベルを変更しました：

```yaml
logging:
  level:
    org.springframework.ai: DEBUG
    org.springframework.ai.anthropic: DEBUG
```

これにより、Anthropic APIとの通信の詳細が確認できます。

#### ✅ 修正2: APIキー設定のデフォルト値追加（完了）

APIキーが設定されていない場合でもアプリケーションが起動するように修正：

```yaml
spring:
  ai:
    anthropic:
      api-key: ${SPRING_AI_ANTHROPIC_API_KEY:}  # ✅ デフォルト値（空文字）を追加
```

### アプリケーションの再起動方法

1. **現在実行中のアプリケーションを停止**
   - コマンドプロンプトで `Ctrl + C` を押す

2. **アプリケーションを再起動**
   ```cmd
   run.bat
   ```

3. **APIキーを入力**
   - Anthropic APIキーを持っている場合は入力
   - 持っていない場合は Enter キーを押してスキップ（AI機能は無効になります）

### APIキーの取得方法

1. [Anthropic Console](https://console.anthropic.com/settings/keys) にアクセス
2. アカウントを作成（まだの場合）
3. 「Create Key」をクリックしてAPIキーを生成
4. 生成されたキーをコピー
5. `run.bat` 実行時にキーを入力

### 確認方法

アプリケーション再起動後、ブラウザで `http://localhost:8080` にアクセスして：

- ✅ **APIキーが正しく設定されている場合:**
  - 記事の要約が日本語で表示される
  - 「【AI要約エラー】」メッセージが表示されない

- ⚠️ **APIキーが設定されていない場合:**
  - 「【AI要約機能は無効です】記事の要約を表示するには、Anthropic APIキーを設定してください。」と表示される
  - 記事のタイトルと本文は正常に取得される

### その他のトラブルシューティング

#### 記事が取得できない場合

1. **インターネット接続を確認**
2. **BBC Sportのサイトがアクセス可能か確認**
   - ブラウザで https://www.bbc.com/sport/football にアクセス
3. **ファイアウォール設定を確認**

#### アプリケーションが起動しない場合

1. **Java 21がインストールされているか確認**
   ```cmd
   java -version
   ```
   - 出力に「21」が含まれていることを確認

2. **ポート8080が使用中でないか確認**
   ```cmd
   netstat -ano | findstr :8080
   ```

3. **ログを確認**
   - コンソールに表示されるエラーメッセージを確認

### サポート

問題が解決しない場合は、以下の情報を含めて報告してください：

1. エラーメッセージの全文
2. `application.yml` の設定内容
3. コンソールに表示されるログ
4. 使用しているJavaのバージョン (`java -version`)
