<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${post.title} + ' - Êµ∑Â§ñ„Çµ„ÉÉ„Ç´„ÉºÊé≤Á§∫Êùø'">„Çπ„É¨„ÉÉ„ÉâË©≥Á¥∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif;
        }
        .post-content {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .reaction-btn {
            transition: all 0.2s;
        }
        .reaction-btn:hover {
            transform: scale(1.2);
        }
        .reaction-btn.active {
            background-color: #3b82f6;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="bg-blue-600 text-white shadow-md">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold">‚öΩ Êµ∑Â§ñ„Çµ„ÉÉ„Ç´„ÉºÊé≤Á§∫Êùø</h1>
                <nav class="space-x-4">
                    <a href="/" class="hover:underline">„Éã„É•„Éº„Çπ</a>
                    <a href="/bbs" class="hover:underline font-bold">Êé≤Á§∫Êùø</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-6">
        <!-- „Éï„É©„ÉÉ„Ç∑„É•„É°„ÉÉ„Çª„Éº„Ç∏ -->
        <div th:if="${success}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
            <span th:text="${success}"></span>
        </div>
        <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            <span th:text="${error}"></span>
        </div>

        <!-- „Éë„É≥„Åè„Åö„É™„Çπ„Éà -->
        <div class="mb-4 text-sm text-gray-600">
            <a href="/bbs" class="hover:underline">Êé≤Á§∫Êùø„Éà„ÉÉ„Éó</a> 
            <span class="mx-2">‚Ä∫</span>
            <span th:text="${post.category}"></span>
        </div>

        <!-- „Çπ„É¨„ÉÉ„ÉâÊú¨Êñá -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-start justify-between mb-4">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded font-medium" 
                              th:text="${post.category}"></span>
                        <h1 class="text-2xl font-bold text-gray-900" th:text="${post.title}"></h1>
                    </div>
                    <div class="flex items-center gap-4 text-sm text-gray-600">
                        <span>üë§ <span th:text="${post.author}"></span></span>
                        <span>üìÖ <span th:text="${#temporals.format(post.createdAt, 'yyyy/MM/dd HH:mm:ss')}"></span></span>
                        <span>üëÅÔ∏è <span th:text="${post.viewCount}"></span></span>
                        <span>üí¨ <span th:text="${post.commentCount}"></span></span>
                    </div>
                </div>
            </div>

            <div class="border-t pt-4 mb-4">
                <div class="post-content text-gray-800 leading-relaxed" th:text="${post.content}"></div>
            </div>

            <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
            <div class="flex gap-2 border-t pt-4">
                <!-- „Åä„Åô„Åô„ÇÅ„Éú„Çø„É≥ -->
                <form th:action="@{/bbs/{id}/recommend(id=${post.id})}" method="post" class="inline">
                    <button type="submit" 
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-medium transition">
                        üëç „Åä„Åô„Åô„ÇÅ (<span th:text="${post.recommendCount}"></span>)
                    </button>
                </form>

                <!-- ÂâäÈô§„Éú„Çø„É≥Ôºà„É¢„Éº„ÉÄ„É´Ë°®Á§∫Ôºâ -->
                <button onclick="showDeleteModal()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded font-medium transition">
                    üóëÔ∏è ÂâäÈô§
                </button>
            </div>
        </div>

        <!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2">
                üí¨ „Ç≥„É°„É≥„Éà (<span th:text="${comments.size()}"></span>)
            </h2>

            <div th:if="${comments.isEmpty()}" class="text-center text-gray-500 py-8">
                „Åæ„Å†„Ç≥„É°„É≥„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
            </div>

            <!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
            <div th:each="comment, iterStat : ${comments}" 
                 class="border-b border-gray-200 py-4 last:border-b-0">
                <div class="flex items-start gap-4">
                    <!-- „Ç≥„É°„É≥„ÉàÁï™Âè∑ -->
                    <div class="flex-shrink-0 w-12 text-center">
                        <span class="inline-block bg-gray-200 text-gray-700 px-2 py-1 rounded text-sm font-bold" 
                              th:text="${comment.commentNumber}"></span>
                    </div>

                    <!-- „Ç≥„É°„É≥„ÉàÂÜÖÂÆπ -->
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2 text-sm text-gray-600">
                            <span class="font-medium text-gray-900" th:text="${comment.author}"></span>
                            <span th:text="${#temporals.format(comment.createdAt, 'yyyy/MM/dd HH:mm:ss')}"></span>
                        </div>
                        <div class="post-content text-gray-800 mb-3" th:text="${comment.content}"></div>
                        
                        <!-- „É™„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
                        <div class="flex items-center gap-2 flex-wrap">
                            <form th:each="reactionType : ${reactionTypes}" 
                                  th:action="@{/bbs/comment/{commentId}/reaction(commentId=${comment.id})}" 
                                  method="post" class="inline">
                                <input type="hidden" name="reactionType" th:value="${reactionType.name()}">
                                <input type="hidden" name="postId" th:value="${post.id}">
                                <button type="submit" 
                                        class="reaction-btn inline-flex items-center gap-1 px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-xs border border-gray-300">
                                    <span th:text="${reactionType.emoji}"></span>
                                    <span th:text="${comment.reactionCounts.get(reactionType) != null ? comment.reactionCounts.get(reactionType) : 0}"></span>
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- ÂâäÈô§„Éú„Çø„É≥ -->
                    <button th:onclick="'showCommentDeleteModal(' + ${comment.id} + ')'" 
                            class="flex-shrink-0 text-gray-400 hover:text-red-600 transition">
                        üóëÔ∏è
                    </button>
                </div>
            </div>
        </div>

        <!-- „Ç¢„É≥„Ç±„Éº„Éà -->
        <div th:if="${poll != null}" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h3 class="text-lg font-bold mb-4 text-gray-800">üìä <span th:text="${poll.question}"></span></h3>
            <div class="space-y-3">
                <div th:each="option : ${poll.options}" class="relative">
                    <form th:action="@{/bbs/poll/{optionId}/vote(optionId=${option.id})}" method="post" class="inline w-full">
                        <input type="hidden" name="postId" th:value="${post.id}">
                        <button type="submit" 
                                class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-blue-50 border border-gray-300 rounded transition">
                            <div class="flex items-center justify-between mb-1">
                                <span class="font-medium" th:text="${option.optionText}"></span>
                                <span class="text-sm text-gray-600">
                                    <span th:text="${option.voteCount}"></span>Á•® 
                                    (<span th:text="${#numbers.formatDecimal(option.votePercentage, 1, 1)}"></span>%)
                                </span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full transition-all" 
                                     th:style="'width: ' + ${option.votePercentage} + '%'"></div>
                            </div>
                        </button>
                    </form>
                </div>
            </div>
            <div class="mt-4 text-sm text-gray-600 text-center">
                Á∑èÊäïÁ•®Êï∞: <span th:text="${poll.totalVotes}"></span>Á•®
            </div>
        </div>

        <!-- „Ç≥„É°„É≥„ÉàÊäïÁ®ø„Éï„Ç©„Éº„É† -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-bold mb-4 text-gray-800">‚úèÔ∏è „Ç≥„É°„É≥„Éà„ÇíÊäïÁ®ø</h3>
            <form th:action="@{/bbs/{id}/comment(id=${post.id})}" method="post">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÂêçÂâç</label>
                        <input type="text" name="author" required maxlength="50"
                               class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="ÂåøÂêç„Åï„Çì">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">„Ç≥„É°„É≥„Éà</label>
                        <textarea name="content" required rows="4" maxlength="2000"
                                  class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÂâäÈô§Áî®„Éë„Çπ„ÉØ„Éº„Éâ</label>
                        <input type="password" name="password" required minlength="4" maxlength="20"
                               class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="4ÊñáÂ≠ó‰ª•‰∏ä">
                    </div>

                    <div class="flex gap-2">
                        <button type="submit" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-bold transition">
                            üí¨ ÊäïÁ®ø„Åô„Çã
                        </button>
                        <a href="/bbs" 
                           class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded font-bold transition">
                            ‰∏ÄË¶ß„Å´Êàª„Çã
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- „Çπ„É¨„ÉÉ„ÉâÂâäÈô§„É¢„Éº„ÉÄ„É´ -->
    <div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-lg font-bold mb-4">„Çπ„É¨„ÉÉ„Éâ„ÇíÂâäÈô§</h3>
            <form th:action="@{/bbs/{id}/delete(id=${post.id})}" method="post">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">ÂâäÈô§Áî®„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input type="password" name="password" required
                           class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex gap-2">
                    <button type="submit" 
                            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-bold transition">
                        ÂâäÈô§„Åô„Çã
                    </button>
                    <button type="button" onclick="hideDeleteModal()" 
                            class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded font-bold transition">
                        „Ç≠„É£„É≥„Çª„É´
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- „Ç≥„É°„É≥„ÉàÂâäÈô§„É¢„Éº„ÉÄ„É´ -->
    <div id="commentDeleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-lg font-bold mb-4">„Ç≥„É°„É≥„Éà„ÇíÂâäÈô§</h3>
            <form id="commentDeleteForm" method="post">
                <input type="hidden" name="postId" th:value="${post.id}">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">ÂâäÈô§Áî®„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input type="password" name="password" required
                           class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex gap-2">
                    <button type="submit" 
                            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-bold transition">
                        ÂâäÈô§„Åô„Çã
                    </button>
                    <button type="button" onclick="hideCommentDeleteModal()" 
                            class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded font-bold transition">
                        „Ç≠„É£„É≥„Çª„É´
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- „Éï„ÉÉ„Çø„Éº -->
    <footer class="bg-gray-800 text-white text-center py-6 mt-12">
        <p>&copy; 2026 Êµ∑Â§ñ„Çµ„ÉÉ„Ç´„Éº„Éã„É•„Éº„ÇπÊé≤Á§∫Êùø</p>
    </footer>

    <script>
        function showDeleteModal() {
            document.getElementById('deleteModal').classList.remove('hidden');
        }
        
        function hideDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
        }
        
        function showCommentDeleteModal(commentId) {
            const form = document.getElementById('commentDeleteForm');
            form.action = '/bbs/comment/' + commentId + '/delete';
            document.getElementById('commentDeleteModal').classList.remove('hidden');
        }
        
        function hideCommentDeleteModal() {
            document.getElementById('commentDeleteModal').classList.add('hidden');
        }
        
        // ÂÆüÊ≥Å„Çπ„É¨Áî®Ôºö30Áßí„Åî„Å®„Å´Ëá™ÂãïÊõ¥Êñ∞
        let autoRefreshEnabled = false;
        let refreshInterval;
        
        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const btn = document.getElementById('autoRefreshBtn');
            
            if (autoRefreshEnabled) {
                btn.textContent = 'üîÑ Ëá™ÂãïÊõ¥Êñ∞ON';
                btn.classList.add('bg-green-600');
                btn.classList.remove('bg-gray-600');
                
                refreshInterval = setInterval(() => {
                    location.reload();
                }, 30000); // 30Áßí„Åî„Å®
            } else {
                btn.textContent = 'üîÑ Ëá™ÂãïÊõ¥Êñ∞OFF';
                btn.classList.remove('bg-green-600');
                btn.classList.add('bg-gray-600');
                
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                }
            }
        }
    </script>
</body>
</html>
